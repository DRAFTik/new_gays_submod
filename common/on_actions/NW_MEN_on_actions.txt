on_actions = {
	on_startup = {
		effect = { 
			MEN = {
				give_resource_rights = { receiver = SHX state = 621 }
				give_resource_rights = { receiver = SHX state = 746 }
				country_event = bailinmyao.82
			}
		}
	}
	on_monthly_MEN = {
		effect = {
			if = {
				limit = {
					has_idea = MEN_corruption
				}
				set_temp_variable = { MEN_legitimacy_var_temp = 1 }
				add_to_variable = { MEN_legitimacy_var = MEN_legitimacy_var_temp }
				clamp_variable = { var = MEN_legitimacy_var min = 0 max = 100 }
			}
			if = {
				limit = {
					has_dynamic_modifier = {
						modifier = MEN_sale_of_coal
						scope = MEN
					}
				}
				set_variable = { ROOT.MEN_peace_neighbor_country = 0 }
				every_neighbor_country = {
					limit = { 
						NOT = { has_war_with = ROOT } 
					}
					add_to_variable = { ROOT.MEN_peace_neighbor_country = 1 }
				}
				
				if = {
					limit = { 
						check_variable = { ROOT.MEN_peace_neighbor_country > 5 } 
					}
					set_variable = { MEN_sales_of_coal_var_1 = 20 }
					set_variable = { MEN_sales_of_coal_var_2 = 3 }
					multiply_variable = { MEN_sales_of_coal_var_1 = 0.01 }
					add_offsite_building = { type = industrial_complex level = -3 }
					add_offsite_building = { type = industrial_complex level = 3 }
					force_update_dynamic_modifier = yes
				}
				
				else_if = {
					limit = {
						check_variable = { ROOT.MEN_peace_neighbor_country > 2 } 
					}
					set_variable = { MEN_sales_of_coal_var_1 = 15 }
					set_variable = { MEN_sales_of_coal_var_2 = 2 }
					multiply_variable = { MEN_sales_of_coal_var_1 = 0.01 }
					add_offsite_building = { type = industrial_complex level = -3 }
					add_offsite_building = { type = industrial_complex level = 2 }
					force_update_dynamic_modifier = yes
				}
				
				else_if = {
					limit = { 
						check_variable = { ROOT.MEN_peace_neighbor_country > 0 }
					}
					set_variable = { MEN_sales_of_coal_var_1 = 10 }
					set_variable = { MEN_sales_of_coal_var_2 = 1 }
					multiply_variable = { MEN_sales_of_coal_var_1 = 0.01 }
					add_offsite_building = { type = industrial_complex level = -3 }
					add_offsite_building = { type = industrial_complex level = 1 }
					force_update_dynamic_modifier = yes
				}
				
				else = {
					set_variable = { MEN_sales_of_coal_var_1 = 5 }
					multiply_variable = { MEN_sales_of_coal_var_1 = 0.01 }
					add_offsite_building = { type = industrial_complex level = -3 }
					force_update_dynamic_modifier = yes
				}
			}
		}
	}

	on_weekly_MEN = {
		effect = {
			if = {
				limit = {
					NOT = {
						has_country_flag = MEN_end_fight_for_legitimacy
					}
				}
				if = {
					limit = {
						CSR = {
							exists = yes
						}
						MON = {
							exists = yes
						}
					}
					add_to_variable = { MEN_legitimacy_var = -4 }
				}
					
				else_if = {
					limit = {
						OR = {
							AND = {
								MON = {
									exists = yes
								}
								CSR = {
									exists = no
								}
							}
							AND = {
								CSR = {
									exists = yes
								}
								MON = {
									exists = no
								}
							}
						}
					}
					add_to_variable = { MEN_legitimacy_var = -2 }
				}
					
				else_if = {
					limit = {
						CSR = {
							exists = yes
						}
						MON = {
							exists = yes
						}
						has_completed_focus = MEN_full_mongolian_autonomy
					}
					add_to_variable = { MEN_legitimacy_var = -8 }
				}		
					
				else_if = {
					limit = {
						OR = {
							AND = {
								MON = {
									exists = yes
								}
								CSR = {
									exists = no
								}
							}
							AND = {
								CSR = {
									exists = yes
								}
								MON = {
									exists = no
								}
							}
						}
						has_completed_focus = MEN_full_mongolian_autonomy
					}
					add_to_variable = { MEN_legitimacy_var = -4 }
				}
			}
			if = {
				limit = {
					has_idea = MEN_mass_cavalry_idea_3
				}
				
				set_temp_variable = { MEN_nomadism_var_temp = -1 }
				add_to_variable = { MEN_nomadism_var = MEN_nomadism_var_temp }
				custom_effect_tooltip = MEN_nomadism_var_minus_tt
				clamp_variable = { var = MEN_nomadism_var min = 0 max = 100 }

				if = {
					limit = {
						has_idea = MEN_nomadic_population_2 
						check_variable = { MEN_nomadism_var > 74 }		
						check_variable = { MEN_nomadism_var < 78 }
					}
					swap_ideas = {
						remove_idea = MEN_nomadic_population_2 
						add_idea = MEN_nomadic_population_3 
					}
				}

				if = {
					limit = {
						has_idea = MEN_nomadic_population_3 				
						check_variable = { MEN_nomadism_var < 53 }
						check_variable = { MEN_nomadism_var > 49 }		
					}
					swap_ideas = {
						remove_idea = MEN_nomadic_population_3 
						add_idea = MEN_nomadic_population_4 
					}
				}
				
				if = {
					limit = {	
						has_idea = MEN_nomadic_population_4
						check_variable = { MEN_nomadism_var < 28 }
						check_variable = { MEN_nomadism_var > 24 }
					}
					swap_ideas = {
						remove_idea = MEN_nomadic_population_4 
						add_idea = MEN_nomadic_population_5 
					}
				}
				
				if = {
					limit = {
						has_idea = MEN_nomadic_population_5
						check_variable = { MEN_nomadism_var < 4 }
					}
					remove_ideas = MEN_nomadic_population_5
				}
			}
			
			if = {
				limit = {
					has_completed_focus = MEN_special_conditions_for_admission_to_the_army
				}
				if = {
					limit = {
						has_idea = MEN_army_nomadism_elimination_program_idea
					}
					add_to_variable = { MEN_nomadism_var = -1 }
				}
				else_if = {
					limit = {
						has_idea = MEN_army_nomadism_elimination_program_2_idea
					}
					add_to_variable = { MEN_nomadism_var = -2 }
				}
				else_if = {
					limit = {
						has_idea = MEN_army_nomadism_elimination_program_3_idea
					}
					add_to_variable = { MEN_nomadism_var = -3 }
				}
			}
			if = {
				limit = {
					has_completed_focus = MEN_revive_mongolian_kuomintang
				}
				clear_variable = MEN_democratic_popularity_var
				clear_variable = MEN_neutrality_popularity_var
				
				set_variable = { MEN_democratic_popularity_var = party_popularity_100@democratic }
				set_variable = { MEN_neutrality_popularity_var = party_popularity_100@neutrality }
				
				subtract_from_variable = { MEN_democratic_popularity_var = MEN_neutrality_popularity_var }
				
				if = {
					limit = {
						check_variable = { MEN_democratic_popularity_var > 20 }
					}
					remove_ideas = {
						MEN_weak_predominance_of_reformers_idea
						MEN_balance_between_reactionaries_and_reformers_idea
						MEN_weak_predominance_of_reactionaries_idea
						MEN_large_predominance_of_reactionaries_idea
					}
					if = {
						limit = {
							NOT = {
								has_idea = MEN_large_predominance_of_reformers_idea
							}
						}
						add_ideas = MEN_large_predominance_of_reformers_idea
					}
				}
				else_if = {
					limit = {
						check_variable = { MEN_democratic_popularity_var > 10 }
						check_variable = { MEN_democratic_popularity_var < 20 }
					}
					remove_ideas = {
						MEN_large_predominance_of_reformers_idea
						MEN_balance_between_reactionaries_and_reformers_idea
						MEN_weak_predominance_of_reactionaries_idea
						MEN_large_predominance_of_reactionaries_idea
					}
					if = {
						limit = {
							NOT = {
								has_idea = MEN_weak_predominance_of_reformers_idea		
							}
						}						
						add_ideas = MEN_weak_predominance_of_reformers_idea
					}
				}
				else_if = {
					limit = {
						check_variable = { MEN_democratic_popularity_var < 10 }
						check_variable = { MEN_democratic_popularity_var > -10 }
					}
					remove_ideas = {
						MEN_large_predominance_of_reformers_idea
						MEN_weak_predominance_of_reformers_idea
						MEN_weak_predominance_of_reactionaries_idea
						MEN_large_predominance_of_reactionaries_idea
					}
					if = {
						limit = {
							NOT = {
								has_idea = MEN_balance_between_reactionaries_and_reformers_idea
							}
						}
						add_ideas = MEN_balance_between_reactionaries_and_reformers_idea
					}
				}
				else_if = {
					limit = {
						check_variable = { MEN_democratic_popularity_var < -10 }
						check_variable = { MEN_democratic_popularity_var > -20 }
					}
					remove_ideas = {
						MEN_large_predominance_of_reformers_idea
						MEN_weak_predominance_of_reformers_idea
						MEN_balance_between_reactionaries_and_reformers_idea
						MEN_large_predominance_of_reactionaries_idea
					}
					if = {
						limit = {
							has_idea = MEN_weak_predominance_of_reactionaries_idea
						}
						add_ideas = MEN_weak_predominance_of_reactionaries_idea
					}	
				}
				else_if = {
					limit = {
						check_variable = { MEN_democratic_popularity_var < -20 }
					}
					remove_ideas = {
						MEN_large_predominance_of_reformers_idea
						MEN_weak_predominance_of_reformers_idea
						MEN_balance_between_reactionaries_and_reformers_idea
						MEN_weak_predominance_of_reactionaries_idea
					}
					if = {
						limit = {
							NOT = {
								has_idea = MEN_large_predominance_of_reactionaries_idea
							}
						}
						add_ideas = MEN_large_predominance_of_reactionaries_idea
					}
				}
			}
			
			if = {
				limit = {
					OR = {
						has_completed_focus = MEN_constitutional_assembly_of_mongolian_republic
						has_completed_focus = MEN_full_mongolian_autonomy
					}
				}
				if = {
					limit = {
						check_variable = { MEN_legitimacy_var = 100 }
					}
					country_event = bailinmyao.84
				}
				else_if = {
					limit = {
						check_variable = { MEN_legitimacy_var = 0 }
					}			
					ROOT = {
						country_event = bailinmyao.68
					}
					CSR = {
						country_event = bailinmyao.68						
					}
					SHX = {
						country_event = bailinmyao.68						
					}
				}
			}
		}
	}
}